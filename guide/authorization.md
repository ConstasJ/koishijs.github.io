---
sidebarDepth: 2
---

# 用户管理

## 内置用户系统

## 指令权限管理

Koishi 内置了一套用户系统（虽然需要 [数据库](./using-database.md) 的支持）。利用这套系统，我们就可以实现指令的调用权限控制。本节将分别介绍目前支持的权限控制形式。通过向 `ctx.command()` 传入一个对象作为第二或者第三个参数可以修改有关权限管理的一些设置。

### 设置调用权限

Koishi 默认的权限共分为 6 个等级，分别从最低的 0 级到最高的 5 级。指令的调用权限要求默认是 1 级。你可以通过这样的方式设置调用权限：

```js
// 设置 echo 命令的调用权限为 2 级
ctx.command('echo <message...>', '输出收到的信息', { authority: 2 })
  // 设置 -t 选项的调用权限为 3 级
  .option('-t, --timeout <seconds>', '设定延迟发送的时间', { authority: 3 })
```

这样一来，1 级或以下权限的用户就无法调用 echo 指令；2 级权限用户只能调用 echo 指令但不能使用 -t 参数；3 级或以上权限的用户不受限制。

### 设置访问次数上限

有些指令（例如签到抽卡点赞，高性能损耗的计算，限制次数的 API 调用等）我们并不希望被无限制调用，这时我们可以设置每天访问次数的上限：

```js
// 设置 lottery 命令每人每天只能调用 10 次
ctx.command('lottery', '抽卡', { maxUsage: 10 })
  // 设置使用了 -s 的调用不计入总次数
  .option('-s, --show', '查看已经抽到的物品列表', { notUsage: true })
```

这样一来，所有访问 lottery 指令且不含 -s 选项的调用次数上限便被设成了 10 次。当超出总次数后，机器人将回复“调用次数已达上限”。

### 设置最短触发间隔

有些指令（例如高强度刷屏）我们并不希望被短时间内重复调用，这时我们可以设置最短触发间隔：

```js
// 设置 help 命令每 60 秒只能调用 1 次
ctx.command('help', '抽卡', { minInterval: 60000 })
```

这样一来，help 命令被调用后 60 秒内，如果再次被调用，将不会产生任何回答（这个行为也可以被手动修改）。

## 按需加载与更新数据

### 观察者对象

### 控制要加载的字段
